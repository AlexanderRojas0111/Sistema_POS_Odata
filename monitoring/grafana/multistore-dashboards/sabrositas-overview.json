{
  "dashboard": {
    "id": null,
    "title": "Sabrositas POS - Vista General Multi-Sede",
    "tags": ["sabrositas", "multistore", "overview"],
    "timezone": "America/Bogota",
    "refresh": "30s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "panels": [
      {
        "id": 1,
        "title": "Estado General del Sistema",
        "type": "stat",
        "targets": [
          {
            "expr": "count(store_online_status)",
            "legendFormat": "Total Tiendas"
          },
          {
            "expr": "sum(store_online_status)",
            "legendFormat": "Tiendas Online"
          },
          {
            "expr": "count(store_online_status) - sum(store_online_status)",
            "legendFormat": "Tiendas Offline"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "yellow", "value": 0.8},
                {"color": "green", "value": 0.9}
              ]
            }
          }
        },
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "Ventas en Tiempo Real",
        "type": "timeseries",
        "targets": [
          {
            "expr": "sum(rate(store_sales_total[5m])) by (store_name)",
            "legendFormat": "{{store_name}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 10
            },
            "color": {
              "mode": "palette-classic"
            }
          }
        },
        "gridPos": {"h": 8, "w": 16, "x": 8, "y": 0}
      },
      {
        "id": 3,
        "title": "Estado de Sincronización",
        "type": "table",
        "targets": [
          {
            "expr": "store_sync_status",
            "format": "table",
            "instant": true
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {"Time": true, "__name__": true},
              "indexByName": {
                "store_name": 0,
                "store_code": 1,
                "Value": 2,
                "last_sync": 3,
                "sync_health": 4
              },
              "renameByName": {
                "store_name": "Tienda",
                "store_code": "Código",
                "Value": "Estado",
                "last_sync": "Última Sync",
                "sync_health": "Salud"
              }
            }
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Estado"},
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "color-background",
                    "mode": "basic"
                  }
                },
                {
                  "id": "mappings",
                  "value": [
                    {"options": {"1": {"text": "Online", "color": "green"}}, "type": "value"},
                    {"options": {"0": {"text": "Offline", "color": "red"}}, "type": "value"}
                  ]
                }
              ]
            }
          ]
        },
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
      },
      {
        "id": 4,
        "title": "Alertas Activas",
        "type": "alertlist",
        "targets": [],
        "options": {
          "showOptions": "current",
          "maxItems": 10,
          "sortOrder": 1,
          "dashboardAlerts": false,
          "alertName": "",
          "dashboardTitle": "",
          "folderId": null,
          "tags": ["sabrositas"]
        },
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
      },
      {
        "id": 5,
        "title": "Inventario Crítico por Tienda",
        "type": "bargauge",
        "targets": [
          {
            "expr": "sum(store_product_stock <= store_product_min_stock) by (store_name)",
            "legendFormat": "{{store_name}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 5},
                {"color": "red", "value": 10}
              ]
            }
          }
        },
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        },
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
      },
      {
        "id": 6,
        "title": "Performance de API",
        "type": "timeseries",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P95 Latencia"
          },
          {
            "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P50 Latencia"
          },
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "RPS"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "axisPlacement": "left"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "RPS"},
              "properties": [
                {"id": "unit", "value": "reqps"},
                {"id": "custom.axisPlacement", "value": "right"}
              ]
            }
          ]
        },
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
      },
      {
        "id": 7,
        "title": "Transferencias de Inventario",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(inventory_transfer_pending)",
            "legendFormat": "Pendientes"
          },
          {
            "expr": "sum(inventory_transfer_in_transit)",
            "legendFormat": "En Tránsito"
          },
          {
            "expr": "sum(inventory_transfer_overdue)",
            "legendFormat": "Vencidas"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 5},
                {"color": "red", "value": 10}
              ]
            }
          }
        },
        "gridPos": {"h": 6, "w": 8, "x": 0, "y": 24}
      },
      {
        "id": 8,
        "title": "Uso de Recursos del Sistema",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(process_cpu_seconds_total[5m]) * 100",
            "legendFormat": "CPU %"
          },
          {
            "expr": "process_resident_memory_bytes / 1024 / 1024",
            "legendFormat": "Memoria MB"
          },
          {
            "expr": "mysql_connection_pool_active",
            "legendFormat": "Conexiones DB"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "CPU %"},
              "properties": [
                {"id": "unit", "value": "percent"},
                {"id": "max", "value": 100}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "Memoria MB"},
              "properties": [
                {"id": "unit", "value": "decbytes"}
              ]
            }
          ]
        },
        "gridPos": {"h": 6, "w": 16, "x": 8, "y": 24}
      },
      {
        "id": 9,
        "title": "Top Productos Más Vendidos",
        "type": "table",
        "targets": [
          {
            "expr": "topk(10, sum(increase(product_sales_total[1h])) by (product_name))",
            "format": "table",
            "instant": true
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {"Time": true, "__name__": true},
              "renameByName": {
                "product_name": "Producto",
                "Value": "Ventas (1h)"
              }
            }
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 30}
      },
      {
        "id": 10,
        "title": "Mapa de Calor - Actividad por Tienda",
        "type": "heatmap",
        "targets": [
          {
            "expr": "sum(rate(store_activity_total[5m])) by (store_name, hour)",
            "legendFormat": "{{store_name}}"
          }
        ],
        "options": {
          "calculate": false,
          "yAxis": {
            "unit": "short"
          }
        },
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 30}
      }
    ],
    "templating": {
      "list": [
        {
          "name": "store",
          "type": "query",
          "query": "label_values(store_online_status, store_name)",
          "refresh": 1,
          "includeAll": true,
          "multi": true,
          "allValue": ".*"
        },
        {
          "name": "region",
          "type": "query",
          "query": "label_values(store_online_status, region)",
          "refresh": 1,
          "includeAll": true,
          "multi": true
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "name": "Deployments",
          "datasource": "prometheus",
          "enable": true,
          "expr": "deployment_info",
          "iconColor": "blue",
          "titleFormat": "Deployment: {{version}}"
        },
        {
          "name": "Alerts",
          "datasource": "prometheus",
          "enable": true,
          "expr": "ALERTS{alertname=~\".*\"}",
          "iconColor": "red",
          "titleFormat": "{{alertname}}: {{summary}}"
        }
      ]
    }
  },
  "folderId": 0,
  "overwrite": true
}
